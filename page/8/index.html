<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/8/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Java基础/第十四章、并发" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/10/14/Java%E5%9F%BA%E7%A1%80/%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0%E3%80%81%E5%B9%B6%E5%8F%91/" class="article-date">
  <time datetime="2021-10-14T10:09:31.647Z" itemprop="datePublished">2021-10-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java%E5%9F%BA%E7%A1%80/">Java基础</a>
  </div>

  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Java中并发了解和学习"><a href="#Java中并发了解和学习" class="headerlink" title="Java中并发了解和学习"></a>Java中并发了解和学习</h2><p>​    了解Java中的并发需要先清楚进程和线程的区别</p>
<p>​    进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。</p>
<p>​    线程（thread）是操作系统能够进行运算调度的最小单位。它被包含在进程之中，是进程中的实际运作单位。</p>
<p>​    说的更加通俗一点，进程相当于你电脑运行的各个软件，满足的你的不通需求。线程相当于进程中更加小的进程，例如打游戏时，你既可以看到画面，也能听到游戏的声音，这里就是不同的线程。线程和进程的区别本质在于进程之间的变量不通用，但是线程之间时通用的，所以线程之间的通信要比进程有效的多。同时，创建、撤销线程要比进程开销要小得多。下面就来讲讲Java中的线程和并发。</p>
<h3 id="线程的状态"><a href="#线程的状态" class="headerlink" title="线程的状态"></a>线程的状态</h3><p>​    线程的状态有六种。新创建、可运行、被阻塞、等待、计时等待、被终止。这六种状态的图序如下图。<img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_CC357226F5D1-1.jpeg" alt="IMG_CC357226F5D1-1"></p>
<h3 id="线程的属性"><a href="#线程的属性" class="headerlink" title="线程的属性"></a>线程的属性</h3><p>​    说完了线程的状态，下面就要说一下线程的属性，线程的属性有线程优先级、守护线程、线程组、未捕获异常的处理器。</p>
<ul>
<li> 需要注意的是Java中线程的优先级依赖于底层系统的计算，说到底Java还是属于应用层，系统底层也有着自己的优先级，所以优先级的设置只能使该线程在Java中的优先级较高，在底层的优先级不能够确定。</li>
<li>当虚拟机中只剩下守护线程时，虚拟机就退出了，守护线程，字如其意，有其他线程让守护线程守护，守护线程才有意义。</li>
</ul>
<h3 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h3><p>​    并发其实要解决的问题就是多个线程共同使用统一资源的问题（可能有误，欢迎指正）。Java为了防止代码块被并发的访问，最后导致数据的不稳定性。Java提供了一个syncchronized关键字，同时也提供了一个ReentrantLock类。下面就举一个简单的例子。银行转账（大家都用这个例子，我也用）。如果让一百个线程，随机往100个用户里面随机转账，转账完毕后就睡眠。最开始还能保持总金额没有变化，但是随着运行时间越来越长，总金额有可能变大也有可能变小，但是很小的可能会仍然保持不变。这种不确定性就是程序员最害怕的。下面也是用ReentrantLock类来改善这个例子，每次转账时对金额上锁，达到总金额不变的目的。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> syncTrain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * LockBank.java</span></span><br><span class="line"><span class="comment"> * Description: 带锁的银行类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Peng Shiquan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/11/8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockBank</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">double</span>[] accounts;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 条件锁</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Lock banlLock;</span><br><span class="line">    <span class="keyword">private</span> Condition sufficientFunds;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description: 初始化</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> customerNum</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> balance</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>: Peng Shiquan</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>: 2020/11/8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LockBank</span><span class="params">(<span class="keyword">int</span> customerNum, <span class="keyword">double</span> balance)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 填充数值</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        accounts = <span class="keyword">new</span> <span class="keyword">double</span>[customerNum];</span><br><span class="line">        Arrays.fill(accounts, balance);</span><br><span class="line">        banlLock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">        sufficientFunds = banlLock.newCondition();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description: 转账方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> from</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> to</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>: Peng Shiquan</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>: 2020/11/9</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to, <span class="keyword">double</span> money)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        banlLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (accounts[from] &lt; money) &#123;</span><br><span class="line">                <span class="comment">//等待</span></span><br><span class="line">                sufficientFunds.await();</span><br><span class="line">            &#125;</span><br><span class="line">            System.err.println(Thread.currentThread());</span><br><span class="line">            accounts[from] -= money;</span><br><span class="line">            System.out.printf(<span class="string">&quot; %10.2f from %d to %d&quot;</span>, money, from, to);</span><br><span class="line">            accounts[to] += money;</span><br><span class="line">            System.out.printf(<span class="string">&quot;the total balance is %10.2f&quot;</span>, getTotalbalance());</span><br><span class="line">            sufficientFunds.signalAll();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            banlLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description: 获取所有的余额</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> double</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>: Peng Shiquan</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>: 2020/11/9</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getTotalbalance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> sum = <span class="number">0</span>;</span><br><span class="line">        banlLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">double</span> a : accounts) &#123;</span><br><span class="line">                sum += a;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sum;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            banlLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description: 获取当前客户人数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>: Peng Shiquan</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>: 2020/11/9</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCustomerNum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accounts.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> syncTrain;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * BankMain.java</span></span><br><span class="line"><span class="comment"> * Description: 银行测试的主方法</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Peng Shiquan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/11/9</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BankMain</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MACCOUNTS = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">double</span> INITIAL_BALANCE = <span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">double</span> MAX_AMOUNT = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DELAY = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        LockBank lockBank = <span class="keyword">new</span> LockBank(MACCOUNTS, INITIAL_BALANCE);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; MACCOUNTS; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> fromeaccount = i;</span><br><span class="line">            Runnable r = () -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                        <span class="keyword">int</span> toaccount = (<span class="keyword">int</span>) (lockBank.getCustomerNum() * Math.random());</span><br><span class="line">                        <span class="keyword">double</span> money = MAX_AMOUNT * Math.random();</span><br><span class="line">                        lockBank.transfer(fromeaccount, toaccount, money);</span><br><span class="line">                        Thread.sleep((<span class="keyword">int</span>) (DELAY * Math.random()));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            Thread t = <span class="keyword">new</span> Thread(r);</span><br><span class="line">            t.start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    不难看到，总金额运行后是一直保持不变的。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20201214212715997.png" alt="image-20201214212715997"></p>
<p>​    但是这个办法只能用于单个机器，多服务器的情况下仍然会出现金额错乱的情况。使用synchronized关键字的代码如下，只是附上了银行类的代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> syncTrain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SyncBank.java</span></span><br><span class="line"><span class="comment"> * Description:Java关键字synchronized 的使用</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Peng Shiquan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/12/14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SyncBank</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">double</span>[] accounts;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description: 初始化</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> customerNum</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> balance</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>: Peng Shiquan</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>: 2020/11/8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SyncBank</span><span class="params">(<span class="keyword">int</span> customerNum, <span class="keyword">double</span> balance)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 填充数值</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        accounts = <span class="keyword">new</span> <span class="keyword">double</span>[customerNum];</span><br><span class="line">        Arrays.fill(accounts, balance);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description: 转账方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> from</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> to</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> money</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>: Peng Shiquan</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>: 2020/11/9</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to, <span class="keyword">double</span> money)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (accounts[from] &lt; money)</span><br><span class="line">            wait();</span><br><span class="line">        System.err.println(Thread.currentThread());</span><br><span class="line">        accounts[from] -= money;</span><br><span class="line">        System.out.printf(<span class="string">&quot; %10.2f from %d to %d&quot;</span>, money, from, to);</span><br><span class="line">        accounts[to] += money;</span><br><span class="line">        System.out.printf(<span class="string">&quot;the total balance is %10.2f&quot;</span>, getTotalbalance());</span><br><span class="line">        notify();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description: 获取所有的余额</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> double</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>: Peng Shiquan</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>: 2020/11/9</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">double</span> <span class="title">getTotalbalance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">double</span> a : accounts) &#123;</span><br><span class="line">            sum += a;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description: 获取当前客户人数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>: Peng Shiquan</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>: 2020/11/9</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCustomerNum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accounts.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    如何选择这些？怎么知道自己需要哪个？1.不要使用Lock/Condition或者synchronized,多数情况下可以使用阻塞队列来同步完成一个共同任务的线程。2.如果能使用synchronized，尽量使用，可以减少代码，从而达到减少出错的机会。3.如果需要使用到Lock\Condition的特性，才使用Lock\Condition。(书上抄的，就这样吧)</p>
<h3 id="阻塞队列"><a href="#阻塞队列" class="headerlink" title="阻塞队列"></a>阻塞队列</h3><p>​    阻塞队列是为了更加优雅的解决上面的问题，如果开发者太多的参与底层的编写，这个是不合理并且不切实际的。所以就有了阻塞队列的产生，用来解决线程之间共享资源的问题。阻塞队列的流程如下：许多线程向阻塞队列中取出指令并且执行相应命令，如果有生产者插入队列中新的元素或者消费者移除一个元素时，阻塞队列会导致线程阻塞。队列会自动的平衡负载。</p>
<p>下面就来简单编写一个阻塞队列的demo。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> syncTrain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * BlockingQueueTrain.java</span></span><br><span class="line"><span class="comment"> * Description:  阻塞队列的练习</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Peng Shiquan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/12/26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlockingQueueTrain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> FILE_QUEUE_SIZE = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SEARCH_THREADS = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> File DUMMY = <span class="keyword">new</span> File(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> BlockingQueue&lt;File&gt; queue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(FILE_QUEUE_SIZE);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (Scanner in = <span class="keyword">new</span> Scanner(System.in)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Input your directory eg: /Users/pengshiquan/Desktop/Developmentcache/JavaTrain/src/syncTrain&quot;</span>);</span><br><span class="line">            String directory = in.nextLine();</span><br><span class="line">            System.out.println(<span class="string">&quot;Input your keyword eg volatile&quot;</span>);</span><br><span class="line">            String keyword = in.nextLine();</span><br><span class="line">            Runnable enumerator = () -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    enumrate(<span class="keyword">new</span> File(directory));</span><br><span class="line">                    <span class="comment">//通过添加&quot;包尾&quot;来达到通知的效果</span></span><br><span class="line">                    queue.put(DUMMY);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">new</span> Thread(enumerator).start();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; SEARCH_THREADS; i++) &#123;</span><br><span class="line">                Runnable searcher = () -&gt; &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">boolean</span> done = <span class="keyword">false</span>;</span><br><span class="line">                        <span class="keyword">while</span> (!done) &#123;</span><br><span class="line">                            File file = queue.take();</span><br><span class="line">                            <span class="keyword">if</span> (file == DUMMY) &#123;</span><br><span class="line">                                queue.put(file);</span><br><span class="line">                                done = <span class="keyword">true</span>;</span><br><span class="line">                            &#125; <span class="keyword">else</span> search(file, keyword);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">new</span> Thread(searcher).start();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description: 列举目录下所有的文件或者目录，添加到队列中.会循环遍历目录的目录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> directory 需要列举的文件夹或者文件。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>: Peng Shiquan</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>: 2020/12/26</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">enumrate</span><span class="params">(File directory)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        File[] files = directory.listFiles();</span><br><span class="line">        <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">            <span class="keyword">if</span> (file.isDirectory()) enumrate(file);</span><br><span class="line">            <span class="keyword">else</span> queue.put(file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description: 搜索文件中是否含有关键字，有就打印出来</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file    需要搜索的文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> keyword 搜索时的关键字</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>: Peng Shiquan</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>: 2020/12/26</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">search</span><span class="params">(File file, String keyword)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (Scanner in = <span class="keyword">new</span> Scanner(file, <span class="string">&quot;UTF-8&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">int</span> lineNumber = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (in.hasNextLine()) &#123;</span><br><span class="line">                lineNumber++;</span><br><span class="line">                String line = in.nextLine();</span><br><span class="line">                <span class="keyword">if</span> (line.contains(keyword)) &#123;</span><br><span class="line">                    System.out.printf(<span class="string">&quot;%s:%d:%s%n&quot;</span>, file.getPath(), lineNumber, line);</span><br><span class="line">                    <span class="comment">//想法是测试队列的公平性，但是测试结果和预想的不太一样</span></span><br><span class="line">                    <span class="comment">//System.err.println(Thread.currentThread().getId());</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    上面也没有什么难点，说一下大致的思路。这个demo的目的是为了检索用户输入的目录下所有文件含有关键字的行，并且打印该行。demo先是创建一个线程，用来将用户输入的目录下所有的文件或者文件夹放入队列中，另外起大量线程，用来检索文件内是否含有指定关键字。中间一部分代码和预想中的不一致，目前能力有限，也无法验证。就是上面测试队列公平性的代码，发现打印都是用一个线程做的。和我预想中的不太一样。</p>
<h3 id="Callable与Future"><a href="#Callable与Future" class="headerlink" title="Callable与Future"></a>Callable与Future</h3><p>​    在Java中实现多线程有两种方式，一种是继承Thread类，还有一种就是实现Runnable接口。Runnable封装一个异步运行的任务，可以看为一个没有参数和返回值的异步方法。Callable和Runnablee类似，但是有返回值。Callable接口是一个参数化的类型，只有一个方法<code>call()</code>。</p>
<p>​    Future能够保存异步计算的结果，流程是这样的：启动一个计算，将Future对象交给某个线程，然后执行其他任务，Future对象的所有者在结果计算好之后就可以获得它。上面的例子也可以修改为使用Future，代码修改为如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> syncTrain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.FutureTask;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * FutureTest.java</span></span><br><span class="line"><span class="comment"> * Description: Future的练习</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Peng Shiquan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/1/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FutureTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (Scanner in = <span class="keyword">new</span> Scanner(System.in)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Input your directory eg: /Users/pengshiquan/Desktop/Developmentcache/JavaTrain/src/syncTrain&quot;</span>);</span><br><span class="line">            String directory = in.nextLine();</span><br><span class="line">            System.out.println(<span class="string">&quot;Input your keyword eg volatile&quot;</span>);</span><br><span class="line">            String keyword = in.nextLine();</span><br><span class="line">            MathCounter mathCounter = <span class="keyword">new</span> MathCounter(<span class="keyword">new</span> File(directory), keyword);</span><br><span class="line">            FutureTask&lt;Integer&gt; task = <span class="keyword">new</span> FutureTask&lt;Integer&gt;(mathCounter);</span><br><span class="line">            Thread t = <span class="keyword">new</span> Thread(task);</span><br><span class="line">            t.start();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.err.println(task.get() + <span class="string">&quot;符合的行数&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * FutureTest.java</span></span><br><span class="line"><span class="comment"> * Description:  计数类，实现了Callable接口</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Peng Shiquan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/12/29</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MathCounter</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> File directory;</span><br><span class="line">    <span class="keyword">private</span> String keyword;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MathCounter</span><span class="params">(File file, String keyword)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.directory = file;</span><br><span class="line">        <span class="keyword">this</span>.keyword = keyword;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        File[] files = directory.listFiles();</span><br><span class="line">        List&lt;Future&lt;Integer&gt;&gt; result = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (File file : files)</span><br><span class="line">            <span class="keyword">if</span> (file.isDirectory()) &#123;</span><br><span class="line">                MathCounter mathCounter = <span class="keyword">new</span> MathCounter(file, keyword);</span><br><span class="line">                FutureTask&lt;Integer&gt; task = <span class="keyword">new</span> FutureTask&lt;Integer&gt;(mathCounter);</span><br><span class="line">                result.add(task);</span><br><span class="line">                Thread t = <span class="keyword">new</span> Thread(task);</span><br><span class="line">                t.start();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (search(file)) count++;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">for</span> (Future&lt;Integer&gt; integerFuture : result) &#123;</span><br><span class="line">            count += integerFuture.get();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">search</span><span class="params">(File file)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> (Scanner in = <span class="keyword">new</span> Scanner(file, <span class="string">&quot;UTF-8&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">boolean</span> found = <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">while</span> (!found &amp;&amp; in.hasNextLine()) &#123;</span><br><span class="line">                    String line = in.nextLine();</span><br><span class="line">                    <span class="keyword">if</span> (line.contains(keyword)) found = <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> found;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="执行器和线程池"><a href="#执行器和线程池" class="headerlink" title="执行器和线程池"></a>执行器和线程池</h3><p>​    线程的创建事比较消耗资源的，如果程序中创建了大量的短期线程，可以使用线程池来管理和获取。</p>
<p>​    这篇博客前前后后写了很长时间，最后写了感觉也不是很理想，中间也断断续续了几次，这篇博客的知识点我也忘了几次，都是看前面写的才记起来写到哪里。最后发现不是我想象中的学习方式，也记录下来，引以为戒。如果只是死看书很难学到有用的知识，可能就是写了一篇博客，其中的知识点也很难到自己的脑子里。还是好奇法更加容易学习，通过工作中的一个例子，去编写一个demo，再去了解这个demo后面藏着的知识，这样的方式才能让知识更加深刻的到达自己的脑子里面。引以为戒。</p>
<p>​    就这样吧，结束。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/14/Java%E5%9F%BA%E7%A1%80/%E7%AC%AC%E5%8D%81%E5%9B%9B%E7%AB%A0%E3%80%81%E5%B9%B6%E5%8F%91/" data-id="ckuqw9s6t000rxcupbrfog6dg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Java基础/红黑树在HashMap中的应用（一）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/10/14/Java%E5%9F%BA%E7%A1%80/%E7%BA%A2%E9%BB%91%E6%A0%91%E5%9C%A8HashMap%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%EF%BC%88%E4%B8%80%EF%BC%89/" class="article-date">
  <time datetime="2021-10-14T10:09:31.647Z" itemprop="datePublished">2021-10-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java%E5%9F%BA%E7%A1%80/">Java基础</a>
  </div>

  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="红黑树在HashMap中的应用（一）"><a href="#红黑树在HashMap中的应用（一）" class="headerlink" title="红黑树在HashMap中的应用（一）"></a>红黑树在HashMap中的应用（一）</h2><p>​    现在来填上一篇博客的坑，讲一讲红黑树在HashMap中的应用。</p>
<p>​    在讲之前，先要了解一下红黑树，再去阅读源码。本文就是这样的一个结构。但是一开始没有想到红黑树很复杂，篇幅比预期的要大，所以本次红黑树的记录分为三期，坑一定要慢慢填。。</p>
<p>[TOC]</p>
<h3 id="了解红黑树"><a href="#了解红黑树" class="headerlink" title="了解红黑树"></a>了解红黑树</h3><p>​    分析源码肯定要先了解相关概念，了解了概念去看源码就豁然开朗，要不然一直都像无头苍蝇一样，抓不到头绪。</p>
<h4 id="红黑树的历史"><a href="#红黑树的历史" class="headerlink" title="红黑树的历史"></a>红黑树的历史</h4><p>​    红黑树最开始由鲁道夫·贝尔在1972年发明，被称为”对称二叉B树”，它现代的名字源于Leo J. Guibas和Robert Sedgewick于1978年写的一篇论文。但是其代码的实现非常不容易，所以在2008年Robert Sedgewick编写了一个幻灯片，介绍了左倾红黑树，并且给出了简单的实现代码，就此，红黑树就逐渐变成我们如今了解的样子。</p>
<p>​    作为一个合格的开发人员，应该去了解概念的最初形成，知道其根源的理论。网上的大部分文章都介绍了红黑树的五个性质，但是性质来源和为什么有这些性质并没有说清楚。这里因为本人能力有限（英语方面），使用谷歌翻译但是翻译的一塌糊涂。所以最后虽然找到了论文和PPT，但是看不懂。。。（英语的重要性）下面放上链接，同时也希望自己后续英语能力上来后能够填上这个坑。</p>
<p><a target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/abstract/document/4567957">A dichromatic framework for balanced trees</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cs.princeton.edu/~rs/talks/LLRB/RedBlack.pdf">Left-Leaning Red-Black Tree</a></p>
<h4 id="红黑树的来源和变种"><a href="#红黑树的来源和变种" class="headerlink" title="红黑树的来源和变种"></a>红黑树的来源和变种</h4><p>​    如果你也和我一样在网上找了一圈相关的论文资料，估计这个小节你已经有了相关的概念。红黑树并不是凭空出来的新概念，只是将最开始的概念进行完善和代码化。下面我就按照完善的顺序介绍各种二叉树的变种。直到最后介绍红黑树，</p>
<h5 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h5><p>​    二叉树（binary tree）是最开始的树，就是一个简单的只有两个字节点的树。甚至节点之间都没有顺序。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210309184758580.png" alt="image-20210309184758580"></p>
<h5 id="二叉查找树"><a href="#二叉查找树" class="headerlink" title="二叉查找树"></a>二叉查找树</h5><p>​    二叉查找树（BST，binary search tree）是二叉树的进化，在二叉树的基础上增加了有序性，我们平时说的二叉树也是指的二叉查找树。二叉查找树能够快速的查找、删除、插入元素。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210309185136325.png" alt="image-20210309185136325"></p>
<p>​    但是二叉查找树有一个致命因素，如果元素在特殊情况下插入，二叉树会变成一种单链表，如下图：</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210309185326382.png" alt="image-20210309185326382"></p>
<p>​    所以二叉查找树在特殊情况下的时间复杂度非常差。</p>
<h5 id="AVL树"><a href="#AVL树" class="headerlink" title="AVL树"></a>AVL树</h5><p>​    AVL树（由发明者Adelson-Velsky 和 Landis 的首字母缩写命名）是指任意节点的两个子树的高度差不超过1的平衡树。</p>
<p>​    <img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210309190241163.png" alt="image-20210309190241163"></p>
<p>​    上面的树就是AVL树，不是很容易理解，并且AVL树实现自平衡的过程很复杂，这里就不再详细描述了。</p>
<h5 id="2-3树"><a href="#2-3树" class="headerlink" title="2-3树"></a>2-3树</h5><p>​    2-3树的定义如下：每个具有子节点的节点（内部节点，internal node）要么有两个子节点和一个数据元素，要么有三个子节点和两个数据元素的自平衡的树，它的所有叶子节点都具有相同的高度。</p>
<p>​    <img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210310163055451.png" alt="image-20210310163055451"></p>
<p>​    2-3树的逻辑还是能够理解的，主要就是维持2-3树的特点，如果出现了不符合2-3树的特征，就需要将数据元素或者字节点往上移动。下面列举一个2-3树生长轨迹图。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210310165516582.png" alt="image-20210310165516582"></p>
<p>​    图的来源为：<a target="_blank" rel="noopener" href="http://ddrv.cn/a/104429">算法网</a></p>
<h5 id="2-3-4树"><a href="#2-3-4树" class="headerlink" title="2-3-4树"></a>2-3-4树</h5><p>​    2-3-4树，它的每个非叶子节点，要么是2节点，要么是3节点，要么是4节点，且可以自平衡，所以称作2-3-4树。2节点：包含两个子节点和一个数据元素；3节点：包含三个子节点和两个数据元素；4节点：包含四个子节点和三个数据元素；</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210310165929418.png" alt="image-20210310165929418"></p>
<p>​        2-3-4树是2-3树的进阶版，在2-3树的转换过程中会发现有一种中间状态和上面的图类似，就是具有四个节点和三个数据元素，如果这种状态合法，它就是2-3-4树。</p>
<p>​    如果2-3-4树转换的中间状态也是合法的，就又产生了一种新的树，2-3-4-5树。这样类似的树统称为B树，它允许一个节点可以有多于两个子节点，同时，也是自平衡的，叶子节点的高度都是相同的。B树多了一个概念叫“度”，2-3树的度就是3，2-3-4树多度就是4，度就是表示该树最多拥有多少字节点。</p>
<h5 id="红黑树"><a href="#红黑树" class="headerlink" title="红黑树"></a>红黑树</h5><p>​    红黑树其实是由2-3-4树变种而来（也有说是2-3树变种而来，这里不再讨论详细内容），因为2-3-4树代码的实现比较复杂，所以产生了红黑树（代码实现也不简单）。先说一下红黑树的五条性质。</p>
<ul>
<li>节点是要么红色或要么是黑色。</li>
<li>根一定是黑色节点。</li>
<li>每个叶子结点都带有两个空的黑色结点（称之为NIL节点，它又被称为黑哨兵）。</li>
<li>每个红色节点的两个子节点都是黑色（或者说从每个叶子到根的所有路径上不能有两个连续的红色节点）。</li>
<li>从任一节点到它所能到达得叶子节点的所有简单路径都包含相同数目的黑色节点。</li>
</ul>
<p>​    现在五条性质不清楚原因没有关系，可以在后面慢慢的去了解其意义，或者在上面的论文和幻灯片中寻找答案。和我之前想的一样，不同的高度看到和理解的东西是不一样的，很难一次就理解红黑树的全部概念。列举一个和上面2-3-4树数据元素一致的红黑树。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210310182116361.png" alt="image-20210310182116361"></p>
<p>​    这样看的话是不是就能理解为什么红黑树是2-3-4树的变种了？对比五条性质就更能理解这个图。如果上面的两个图片还是抽象，我寻找了画的比我好的一个示意图。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210310194048137.png" alt="image-20210310194048137"></p>
<p>​    到此，红黑树的来源和中间的一些变种就全部了解完毕。这一部分借鉴了其他人的博客，这里放上链接。</p>
<p>​    <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000024499075">红黑树的来源和变种的讲解</a></p>
<h4 id="红黑树的五条性质及其解释"><a href="#红黑树的五条性质及其解释" class="headerlink" title="红黑树的五条性质及其解释"></a>红黑树的五条性质及其解释</h4><p>​    红黑树的五条性质在上面有说到过，下面就一一分析这五条性质。</p>
<h5 id="2-3-4树和红黑树之间的转换"><a href="#2-3-4树和红黑树之间的转换" class="headerlink" title="2-3-4树和红黑树之间的转换"></a>2-3-4树和红黑树之间的转换</h5><p>​    既然说了红黑树来源于2-3-4树，所以两者肯定可以转换，并且红黑树的五条性质也是依赖于这些转换过程的。下面给出转换的图例和解析。2-3-4树只存在2、3、4节点的情况，临时的节点情况不再本次分析之内。</p>
<ul>
<li>2节点。2节点比较简单，直接转换为红黑树中的黑色节点即可，如下图：</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210314142331015.png" alt="image-20210314142331015"></p>
<p>​    这个还是很好理解的，就是简单将节点赋予颜色，没有什么难点。</p>
<ul>
<li>3节点。3节点有些特殊，存在两个情况，也是红黑树的分支由来，即左倾红黑树和右倾红黑树。如下图：</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210314143232558.png" alt="image-20210314143232558"></p>
<p>​    这里就可以看到颜色的意义，红色本身是没有任何含义的，红色的节点是要结合它的父树一起来看才能看出这棵红黑树树的含义。</p>
<ul>
<li>4节点。4节点和2节点相似，只存在一种情况，如下图：</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210314143711140.png" alt="image-20210314143711140"></p>
<p>​    到此，就可以将任意的一个2-3-4树转换为红黑树，并且可以确定红黑树的颜色。但是因为3节点的存在，所以一个2-3-4树能转换为不同的红黑树，一个红黑树不能转换为多个2-3-4树。</p>
<h5 id="红黑树的性质解析"><a href="#红黑树的性质解析" class="headerlink" title="红黑树的性质解析"></a>红黑树的性质解析</h5><p>​    红黑树的性质上面已经说过了，并且也已经了解了2-3-4树和红黑树的互相转换，可以开始解析对应的五条性质了。</p>
<ul>
<li><p><strong>节点是要么红色或要么是黑色。</strong>这个性质还是比较好理解的，红黑树只存在黑色和红色，如果有其他颜色也就不叫红黑树了。需要注意的是如果一个红黑树全部存在黑色或者红色呢？也不是不可以，但是红黑树是来源于2-3-4树，全是黑色或者全是红色显然无法分辨出是2节点还是3节点，一个红黑树也就对应多个2-3-4树了。不符合要求，并且代码也无法实现。</p>
</li>
<li><p><strong>根一定是黑色节点。</strong>这个性质可能要思考一下，红黑树来源于2-3-4树，通过上面的转换不难发现无论是2、3还是4节点，最后转换为红黑树都是黑色节点在上。所以根节点就无论如何都是黑色的了。</p>
</li>
<li><p><strong>每个叶子结点都带有两个空的黑色结点（称之为NIL节点，它又被称为黑哨兵）。</strong>这个性质我现在还不是很理解，找了一下，大部分的解释是为了区分某些不属于红黑树的特殊情况，这里也留个坑吧，也欢迎大佬给出解答。而这也是为什么链表中通常会有哨兵节点的原因，就是为了避免各种判空，这样既容易出错也会让代码一团糟。</p>
</li>
<li><p><strong>每个红色节点的两个子节点都是黑色（或者说从每个叶子到根的所有路径上不能有两个连续的红色节点）。</strong>这个性质也需要思考一会，还是那句话，红黑树来源于2-3-4树，看看2-3-4树什么情况下会转换为红色树，只有3和4节点，之前也说过红树是结合父树来看的，如果3节点增加红树，对应的就是4节点，但是4节点只存在唯一的情况，所以不行。4节点就更容易理解了，添加一个红树，变为5节点，但是5节点是临时态，实际是不应该存在的，最后还是会转换为其他形态。解释如下图。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210314150143548.png" alt="image-20210314150143548"></p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210314150159674.png" alt="image-20210314150159674"></p>
</li>
<li><p>  <strong>从任一节点到它所能到达得叶子节点的所有简单路径都包含相同数目的黑色节点。</strong>这个性质也是能够理解的，通过上面的转换可以看到只有黑色节点代表一层，红色节点其实和父黑色节点同属于一层，所以黑色节点代表层数。同时红黑树是做了平衡的，和2-3-4树一样，到达子节点的层数都是一致的，即到达任何一个子节点的黑色节点树相同。</p>
</li>
</ul>
<h4 id="红黑树的操作及其分析"><a href="#红黑树的操作及其分析" class="headerlink" title="红黑树的操作及其分析"></a>红黑树的操作及其分析</h4><p>​    讲解完了红黑树的来源和性质，下面就可以讲解一下红黑树具体的操作和对这些操作的分析。</p>
<p>​    红黑树的平衡操作有三种：左旋转、右旋转、染色。下面就一一解析这些操作。具体的插入和操作放到下一片博客讲。</p>
<h5 id="左旋转"><a href="#左旋转" class="headerlink" title="左旋转"></a>左旋转</h5><p>​    左旋转的作用就是将一个向右倾斜的二叉树平衡，转化为左链接。如下示意图。（插入顺序为1-2-3）</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210310195710789.png" alt="image-20210310195710789"></p>
<p>​    通过将这个二叉树左旋，就是将1节点变为2节点的左节点，同时改变颜色（这一步骤其实不涉及染色）。变成如下图。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210310200014187.png" alt="image-20210310200014187"></p>
<h5 id="右旋转"><a href="#右旋转" class="headerlink" title="右旋转"></a>右旋转</h5><p>​    举一反三，看过上面就大致猜到了右旋转就是将左倾斜的二叉树平衡，转化为右链接。如下示意图。（插入顺序为3-2-1）</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210310200442968.png" alt="image-20210310200442968"></p>
<p>​    和上面的相反，将二叉树右旋，将3节点变为2节点的右节点。变成如下图。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210310200635557.png" alt="image-20210310200635557"></p>
<h5 id="染色"><a href="#染色" class="headerlink" title="染色"></a>染色</h5><p>​    旋转完后或者插入节点后，很大概率红黑树的节点颜色是不符合要求的，所以需要将红黑树节点的颜色进行改变，变成符合五条性质的红黑树。还是以上面的左旋转为例。</p>
<p>​    旋转完毕，但是不染色。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210310201209652.png" alt="image-20210310201209652"></p>
<p>​    很明显不符合红黑树的性质4，所以要对节点的颜色进行变换，变成符合要求的如下的红黑树。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210310200635557.png" alt="image-20210310200635557"></p>
<p>​    </p>
<p>​    红黑树为了平衡的三个操作都已经了解了，剩下的就是实践了，这一部分比较耗费时间和画图。。。所以不再博客中叙述。只需要记住一点，无论经过什么操作，红黑树需要满足自身的平衡要求并且也要符合红黑树的五条性质，剩下的自己就是慢慢画和理解了。</p>
<p>​    这一部分也借鉴了其他人的成果，这里放上链接。</p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000023715473?utm_source=sf-related">红黑树的操作解析</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cs.usfca.edu/~galles/visualization/RedBlack.html">红黑树的在线演示图，可以在这里验证自己的思路</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/14/Java%E5%9F%BA%E7%A1%80/%E7%BA%A2%E9%BB%91%E6%A0%91%E5%9C%A8HashMap%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%EF%BC%88%E4%B8%80%EF%BC%89/" data-id="ckuqw9s6t000sxcup7aotfplr" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Java基础/红黑树在HashMap中的应用（二）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/10/14/Java%E5%9F%BA%E7%A1%80/%E7%BA%A2%E9%BB%91%E6%A0%91%E5%9C%A8HashMap%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%EF%BC%88%E4%BA%8C%EF%BC%89/" class="article-date">
  <time datetime="2021-10-14T10:09:31.647Z" itemprop="datePublished">2021-10-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java%E5%9F%BA%E7%A1%80/">Java基础</a>
  </div>

  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="红黑树在HashMap中的应用（二）"><a href="#红黑树在HashMap中的应用（二）" class="headerlink" title="红黑树在HashMap中的应用（二）"></a>红黑树在HashMap中的应用（二）</h2><p>​    上一篇博客讲述了红黑树的历史来源，阐述了红黑树的五条性质，并且解释了五条性质的原因。下面就来实际操作一下，讲解一下红黑树对于节点的插入和删除。</p>
<p>[TOC]</p>
<h3 id="红黑树的插入和删除"><a href="#红黑树的插入和删除" class="headerlink" title="红黑树的插入和删除"></a>红黑树的插入和删除</h3><p>​    在之前不止一次的说过红黑树来源于2-3-4树，所以插入和删除也是，不了解2-3-4树的插入、删除操作，很难直接上手红黑树。本文的结构就如此，先介绍2-3-4树的插入、删除操作，再去解析红黑树的对应操作。</p>
<h4 id="2-3-4树的插入、删除操作"><a href="#2-3-4树的插入、删除操作" class="headerlink" title="2-3-4树的插入、删除操作"></a>2-3-4树的插入、删除操作</h4><h5 id="2-3-4树的节点插入"><a href="#2-3-4树的节点插入" class="headerlink" title="2-3-4树的节点插入"></a>2-3-4树的节点插入</h5><p>​    2-3-4树的插入分为几个情况，2节点、3节点、4节点。下面就一一解释和画图举例。</p>
<ul>
<li>2节点插入。这个比较简单，直接将2节点转换为3节点即可。如下图：</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210314162205713.png" alt="image-20210314162205713"></p>
<ul>
<li>3节点插入。这个和2节点差不多，因为最大允许4节点，所以直接插入即可。</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210314163816142.png" alt="image-20210314163816142"></p>
<ul>
<li>4节点插入。这个需要做一下变换，因为5节点是不存在的，所以需要将3个元素的中间元素上移，在放置插入元素即可。如下图：</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210314164631591.png" alt="image-20210314164631591"></p>
<p>到这里，2-3-4的插入就完成了，下面就要讲一下删除了。</p>
<h5 id="2-3-4树的节点删除"><a href="#2-3-4树的节点删除" class="headerlink" title="2-3-4树的节点删除"></a>2-3-4树的节点删除</h5><p>​    删除操作比较复杂一点，分为2节点删除和3、4节点删除，为什么分为两个，下面就清楚了。</p>
<ul>
<li><p>3、4节点删除。直接删除即可。因为是大于2的节点，所以这个时候树的高度没有发生变化，只需要合并子节点或者将子节点用于补位即可。这里就不再画图了，因为情况有些多。</p>
</li>
<li><p>2节点删除。2节点删除网上也有许多方案，这里使用下面这个思路：将当前节点变为大于2节点。或者说，不让删除节点出现在2节点中。分为三个情况。</p>
<ul>
<li>父节点和兄弟节点都大于2.这个情况将父节点中的一个元素下调至删除节点，形成一个3节点。兄弟节点将一个元素上调到父节点。完成删除。如下图：</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210315201220749.png" alt="image-20210315201220749"></p>
<ul>
<li>父节点为大于2节点，兄弟节点为2节点。父节点下调一个元素，和删除元素、兄弟节点一起组成4节点，最后删除要删除的元素。完成删除。如下图：</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210315201735601.png" alt="image-20210315201735601"></p>
<ul>
<li>父节点和兄弟节点都为2节点。父节点下调和删除节点、兄弟节点组成临时节点，删除要删除的节点。完成。如下图：</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210315201929131.png" alt="image-20210315201929131"></p>
</li>
</ul>
<p>​    删除到这里就结束了，当删除元素为2节点并且没有兄弟节点时，无论父节点为几节点，直接删除即可。</p>
<p>​    2-3-4树的插入和删除到这里就暂时结束了，开始编写解析红黑树的插入和删除了。这里水平有限，有些地方可能想的不是很全面，欢迎大佬们的指正。这里借鉴了知乎的回答。连接如下：</p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/312327402/answer/1560653215">知乎关于红黑树的回答</a></p>
<h4 id="红黑树的插入、删除操作"><a href="#红黑树的插入、删除操作" class="headerlink" title="红黑树的插入、删除操作"></a>红黑树的插入、删除操作</h4><p>​    终于讲解到红黑树的插入和删除了，和上面的一样，先分析红黑树的插入（比较简单），然后再去分析红黑树的删除。这里红黑树的基本操作：左旋转、右旋转和染色默认大家都已经清楚了，如果不是很清楚，可以看一下上一篇博客。<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38533859/article/details/114789173?spm=1001.2014.3001.5501">红黑树在HashMap中的应用（一）</a></p>
<p>​    因为红黑树也分为多种，这里以左倾红黑树为例。</p>
<h5 id="红黑树的插入"><a href="#红黑树的插入" class="headerlink" title="红黑树的插入"></a>红黑树的插入</h5><p>​    红黑树的插入的节点默认为红色，上面也能看出，2-3-4树的插入默认都是当前节点，所以红黑树的插入的节点都是临时节点，默认为红色。插入有两种大情况，插入元素的父亲是红色、插入元素的父亲是黑色。下面就一一解析。</p>
<ul>
<li> <strong>插入元素比黑父小</strong>。因为是左倾红黑树，所以当黑父的左节点不存在时，一定没有右节点。所以这种情况直接插入即可。</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210323100150896.png" alt="image-20210323100150896"></p>
<ul>
<li><strong>插入元素比黑父大</strong>。这时分为两个情况。<ul>
<li><strong>当黑父没有左节点时</strong>，直接左旋转黑父、再将父节点和插入节点换色即可。</li>
<li><strong>当黑父有左节点时</strong>，因为这个时候没有破坏红黑树的性质，所以也是直接插入即可。</li>
</ul>
</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210323100513177.png" alt="image-20210323100513177"></p>
<p>​    因为红父是要结合它的黑父节点一起看的，并且红黑树来源于2-3-4树，所以存在红父的情况只有3节点、4节点。3节点和4节点的区别只有红父是否存在兄弟节点。所以红父的情况分为了四种：插入节点有叔父节点且比红父小、插入节点有叔父节点且比红父大、插入节点没有叔父节点且比红父小、插入节点没有叔父节点且比红父大。</p>
<p>​    注意：此时叔父节点不可能为黑色，要不然插入之前的树就不符合红黑树的定义五。</p>
<ul>
<li><strong>插入节点有叔父节点且比红父小。</strong>这个形态对应的是2-3-4树的4节点，所以要此时的临时5节点分裂，将树的高度加一，即将叔父节点和红父节点的颜色与祖父节点互换。因为比红父小，所以符合左倾红黑树要求。但是这时，祖父节点因为变换了颜色，所以将祖父节点当作插入节点，再执行修复操作。</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210323103124602.png" alt="image-20210323103124602"></p>
<ul>
<li><strong>插入节点有叔父节点且比红父大。</strong>这个形态和上面类似，不过因为比红父大，所以不符合左倾红黑树的要求，需要再做一个转换。这里就不再画图了，脑中过一遍就能理解。</li>
<li><strong>插入节点没有叔父节点且比红父小。</strong>这个形态对应2-3-4树的3节点，插入此节点不会导致高度的变化，所以就是需要将红父进行右旋转。</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210323111003906.png" alt="image-20210323111003906"></p>
<ul>
<li><strong>插入节点没有叔父节点且比红父大。</strong>此时树应该是右倾的，所以需要将树变为左倾，再转换为上面步骤即可，如下图：</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210323112156656.png" alt="image-20210323112156656"></p>
<p>​    这些插入结束后需要注意一点，因为祖父节点产生了变化，所以需要对祖父节点进行回溯，即将祖父节点当作插入节点，在执行这个步骤，直到根节点符合要求。    </p>
<p>至此，红黑树的插入就全部例举完毕了，同时需要注意还有一点是不是对红黑树的理解又加深了？因为本人水平有限，可能有些地方有误或者不清晰，欢迎大佬的指正。</p>
<h5 id="红黑树的删除"><a href="#红黑树的删除" class="headerlink" title="红黑树的删除"></a>红黑树的删除</h5><p>​    红黑树的删除比较复杂，考虑的情况要比插入多一些。这里也是举例说明，希望自己能够理清，也欢迎大家指正。</p>
<h6 id="了解删除前需要了解的"><a href="#了解删除前需要了解的" class="headerlink" title="了解删除前需要了解的"></a>了解删除前需要了解的</h6><p>​    了解删除前需要了解一些知识点。关于二叉树通用的删除策略。</p>
<ul>
<li>删除某个节点时，可以选择该节点的前驱节点或者后继节点来替代它。这个需要思考一下，并不是很难。<ul>
<li>前驱节点：该节点的左子树的最右节点。</li>
<li>后继节点：该节点的右子树的最左节点。</li>
</ul>
</li>
</ul>
<h6 id="红黑树删除的情况"><a href="#红黑树删除的情况" class="headerlink" title="红黑树删除的情况"></a>红黑树删除的情况</h6><p>​    红黑树删除分为三个大情况，三个大情况又各自进行细分。如下图：</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210323182608315.png" alt="image-20210323182608315"></p>
<p>​    下面就需要对没有子节点的情况进行分析。</p>
<ul>
<li> 删除节点为红色：因为红色对应着2-3-4树的3、4节点，由上面可知，直接删除即可。没有什么好说的。结果如下图：</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210323182954212.png" alt="image-20210323182954212"></p>
<ul>
<li><p>删除节点为黑色。因为黑色其实代表了一个2-3-4中的一个层级，删除层级肯定对红黑树的实际高度有影响，所以需要做一定的调整。并且按照上面的步骤，删除的黑色节点其实对应了2-3-4树中删除2节点，所以删除红黑树的黑色子叶节点需要观察父节点和兄弟节点，这也是网上大家都这样说的原因。这样就简单了，按照2-3-4树进行理解和分析吧。</p>
<p>还是先说说情况，总共有六种，但是中间一些情况的处理时一样的。情况如下图：（因为为左倾红黑树，所以不存在兄弟节点为红色）</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210323204709003.png" alt="image-20210323204709003"></p>
<ul>
<li>当兄没有红子节点时，无论父是否为红，最后都变为父黑兄红。其实对应了2-3-4树中的删除2节点时，兄弟节点也为2节点。最后都是父节点和兄弟节点组成一个三节点的子树。如下图：</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210323211215752.png" alt="image-20210323211215752"></p>
<ul>
<li>当兄有一个红色节点时，无论父是否为红，最后都是兄弟节点代替父节点、父节点代替删除节点、兄弟子节点代替兄弟节点。如下图：</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210323211409899.png" alt="image-20210323211409899"></p>
<ul>
<li>当兄弟有两个红色时，无论父是否红，最后都是兄弟节点代替父节点、父节点代替删除节点、兄弟节点的左节点挂在删除节点下、兄弟节点的右节点代替兄弟节点、最后父节点再左旋转。如下图：</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20210323211559996.png" alt="image-20210323211559996"></p>
</li>
</ul>
<p>​    至此，红黑树的删除也讲完了。这一块不是很容易理解，我画的图也不会动，所以最后还是需要靠自己去一点点想象（。。。）中间也看了很多的博客，对于自己的理解有很大的帮助，下面就放上链接。</p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000023715473?utm_source=sf-related">删除操作类举比较详细</a></p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/312327402/answer/1560653215">红黑树的插入讲的不错</a></p>
<p>​    上面的链接只是个人的判断，当你理解其含义后，各个方法也就能懂其意思了。</p>
<p>​    讲完了红黑树的插入和删除，下面就要上实现代码了，这里直接阅读JDK的源码，分析一下HashMap中红黑树的实现（讲到现在终于靠题了）。这篇博客花了很长的时间，后面也会单独分析一下原因，技术应该没有如此难学。</p>
<p>​    就这样吧，结束。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/14/Java%E5%9F%BA%E7%A1%80/%E7%BA%A2%E9%BB%91%E6%A0%91%E5%9C%A8HashMap%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%EF%BC%88%E4%BA%8C%EF%BC%89/" data-id="ckuqw9s6u000txcupfck49u39" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Linux学习/第七章、Linux文件系统" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/10/14/Linux%E5%AD%A6%E4%B9%A0/%E7%AC%AC%E4%B8%83%E7%AB%A0%E3%80%81Linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" class="article-date">
  <time datetime="2021-10-14T10:09:31.647Z" itemprop="datePublished">2021-10-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux%E5%AD%A6%E4%B9%A0/">Linux学习</a>
  </div>

  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="第七章、Linux文件系统"><a href="#第七章、Linux文件系统" class="headerlink" title="第七章、Linux文件系统"></a>第七章、Linux文件系统</h2><h3 id="Linux文件系统"><a href="#Linux文件系统" class="headerlink" title="Linux文件系统"></a>Linux文件系统</h3><ul>
<li><p>Linux的EXT2文件系统</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_3DFC7CA9B512-1.jpeg" alt="IMG_3DFC7CA9B512-1"></p>
<ul>
<li><p>Data block 是用来放置文件内容数据的地方。Ext2系统中所支持的blokc大小有1、2，4K三种。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_2488E99AAFB4-1.jpeg" alt="IMG_2488E99AAFB4-1"></p>
</li>
<li><p>Inode table 是记录文件的属性以及该文件实际数据是放在哪个block中的。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_F2D95A3DEA87-1.jpeg" alt="IMG_F2D95A3DEA87-1"></p>
<p>inode还有下面的特点。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_7173E6AAB4C5-1.jpeg" alt="IMG_7173E6AAB4C5-1"></p>
<p>inode的记录结构图，最小的1K的block可以容纳16GB的文件。<code>12+256+256*256+256*256*256=16GB</code></p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_B0821E59ADEE-1.jpeg" alt="IMG_B0821E59ADEE-1"></p>
</li>
<li><p>Superblock记录整个filesystem相关信息的地方。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_163F8E9E2A81-1.jpeg" alt="IMG_163F8E9E2A81-1"></p>
</li>
<li><p>Filesytem Description（文件系统描述说明）描述每个block group的开始与结束的block号码，以及说明每个区段分别介于哪一个block号码之间。</p>
</li>
<li><p>Block bitmap(区块对照表)记录系统中空的block号码。</p>
</li>
<li><p>Inode bitmap（inode 对照表）记录未使用的inode号码。</p>
</li>
<li><p><code>dumpe2fs</code> 查询Ext家族superblock信息的指令。（不常用）</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_51A8DF0CE1DB-1.jpeg" alt="IMG_51A8DF0CE1DB-1"></p>
</li>
<li><p>文件的读取流程</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_7F443C85D318-1.jpeg" alt="IMG_7F443C85D318-1"></p>
</li>
</ul>
</li>
<li><p>XFS文件系统简介</p>
<ul>
<li><p>资料区。分为多个存储群组，每个群组包含（1）整个文件系统的 superblock、 (2)剩余空间的管理机制、 (3)inode 的分配与追踪。</p>
</li>
<li><p>文件系统活动登录区。主要记录文件系统的变化，有点类似于日志区。</p>
</li>
<li><p>实时运作区。记录extent区块的信息。</p>
</li>
<li><p><code>xfs_info</code>指令的用法</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_368E80FB9615-1.jpeg" alt="IMG_368E80FB9615-1"></p>
</li>
</ul>
</li>
<li><p>文件系统的简单操作</p>
<ul>
<li><p><code>df</code>列出文件系统的整体磁盘使用量</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_0AAC648A473B-1.jpeg" alt="IMG_0AAC648A473B-1"></p>
</li>
<li><p><code>du</code>评估文件系统的磁盘使用量</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_01964E14EB78-1.jpeg" alt="IMG_01964E14EB78-1"></p>
</li>
</ul>
</li>
<li><p>实体链接与符号链接</p>
<ul>
<li><p><code>ln</code>制作链接档。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_C5F5EAF2A276-1.jpeg" alt="IMG_C5F5EAF2A276-1"></p>
<ul>
<li><p>Hard Link（实体链接，硬式连结或实际连结）在某个目录下新增一笔档名链接到某inode号码的关联记录。</p>
</li>
<li><p>Symbolic Link(符号链接，类似于快捷方式) 建立一个独立的文件，而这个文件会让数据的读取指向link的那个文件档名。会创建新的inode和block，但是要比原档名小的多。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>磁盘的分区、格式化、检验与挂载</p>
<ul>
<li><p><code>lsblk</code>列出系统上所有的磁盘列表。<br><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_881CF83F6037-1.jpeg" alt="IMG_881CF83F6037-1"></p>
</li>
<li><p><code>blkid</code>列出装置的UUID等参数</p>
</li>
<li><p><code>parted</code>列出磁盘的分区表类型与分区信息</p>
</li>
<li><p>分区的步骤：先通过<code>lsblk</code>或者<code>blkid</code>找到磁盘，再通过<code>parted /dev/xxx print</code> 找到该磁盘的分区类型，之后通过<code>fdisk</code>(MBR分区)或者<code>gdisk</code>(GPT分区)来操作磁盘。</p>
</li>
<li><p><code>mkfs.xfs</code>命令是建置文件系统</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_C576B170E89D-1.jpeg" alt="IMG_C576B170E89D-1"></p>
</li>
<li><p>EXT4文件系统的<code>mkfs.ext4</code></p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_D34A4CD5C7F0-1.jpeg" alt="IMG_D34A4CD5C7F0-1"></p>
</li>
</ul>
</li>
<li><p>文件系统的检验</p>
<ul>
<li><p><code>xfs_repair</code>处理XFS文件系统<br><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_ED943AA7B08E-1.jpeg" alt="IMG_ED943AA7B08E-1"></p>
</li>
<li><p><code>fsck.ext4</code>处理EXT4文件系统</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_1AC76C5CAAB8-1.jpeg" alt="IMG_1AC76C5CAAB8-1"></p>
</li>
</ul>
</li>
<li><p>文件系统的挂载和卸除</p>
<ul>
<li><p><code>mount</code>挂载使用到的命令</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_EF0C6D310CCA-1.jpeg" alt="IMG_EF0C6D310CCA-1"></p>
</li>
<li><p><code>umount</code>将装置文件卸除的命令</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_D4FFFBEBEEE1-1.jpeg" alt="IMG_D4FFFBEBEEE1-1"></p>
</li>
</ul>
</li>
<li><p>设置开机挂载</p>
<ul>
<li><p>/etc/fstab文件内容</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20200421091505802.png" alt="image-20200421091505802"></p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_DA7EB7846934-1.jpeg" alt="IMG_DA7EB7846934-1"></p>
<ul>
<li><p>磁盘装置文件名/UUID/LABEL name。 例子：/dev/vda2.  UUID=xxx.  LABEL=xxx</p>
</li>
<li><p>挂载点。一定要是目录</p>
</li>
<li><p>磁盘分区槽的文件系统。如xfs,ext4,vfat,reiserfs,nfs</p>
</li>
<li><p>文件系统参数</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_01E1BA15FC1D-1.jpeg" alt="IMG_01E1BA15FC1D-1"></p>
</li>
<li><p>能否被dump备份指令作用。0即可</p>
</li>
<li><p>是否以fsck检验扇区。xfs文件系统会自己检查，直接填0即可</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>特殊装置loop挂载</p>
<ul>
<li><p>以挂载一个文件为例</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20200421134709795.png" alt="image-20200421134709795"></p>
</li>
</ul>
</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20200421134803389.png" alt="image-20200421134803389"></p>
<p>步骤：1.建立大型文件。2.大型文件格式化。3.将大型文件挂载到目录（通过UUID的形式）</p>
<ul>
<li><p>内存置换空间（swap）之建置（用处不大，看看就可以）</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_57EEF927240A-1.jpeg" alt="IMG_57EEF927240A-1"></p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/14/Linux%E5%AD%A6%E4%B9%A0/%E7%AC%AC%E4%B8%83%E7%AB%A0%E3%80%81Linux%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" data-id="ckuqw9s6v000uxcup8essduct" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Linux学习/第九章、vim程序编辑器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/10/14/Linux%E5%AD%A6%E4%B9%A0/%E7%AC%AC%E4%B9%9D%E7%AB%A0%E3%80%81vim%E7%A8%8B%E5%BA%8F%E7%BC%96%E8%BE%91%E5%99%A8/" class="article-date">
  <time datetime="2021-10-14T10:09:31.647Z" itemprop="datePublished">2021-10-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux%E5%AD%A6%E4%B9%A0/">Linux学习</a>
  </div>

  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="第九章、vim程序编辑器"><a href="#第九章、vim程序编辑器" class="headerlink" title="第九章、vim程序编辑器"></a>第九章、vim程序编辑器</h2><ul>
<li><p>vi的基础了解</p>
<p>vi分为三种模式，<code>一般命令模式</code>，<code>编辑模式</code>，<code>指令列命令模式</code>。</p>
<ul>
<li>一般指令模式。默认就是一般指令模式，在该模式下可以使用上下左右进行光标移动，也可以使用指令对处理文本内容，如：复制，删除…</li>
<li>编辑模式。按下<code>i,I,o,O,a,A,r,R</code>中任何一个字母后进入编辑模式，左下方会出现[INSERT],[REPLACE]的提示。退出编辑模式只需要按[esc]键即可。</li>
<li>指令列命令模式。一般模式中，输入<code>:/?</code>三个按钮中任何一个就可以进入指令列命令模式。光标会移动到最底下那一列。对文档的额外操作可以通过指令列命令模式进行</li>
</ul>
</li>
<li><p>按键说明</p>
<p> <img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_938F47F946DA-1.jpeg" alt="IMG_938F47F946DA-1"></p>
<p> <img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_0813AAE3737A-1.jpeg" alt="IMG_0813AAE3737A-1"></p>
<p> <img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_26DFD8F9FEE6-1.jpeg" alt="IMG_26DFD8F9FEE6-1"></p>
<p> <img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_17D2939DE8E2-1.jpeg" alt="IMG_17D2939DE8E2-1"></p>
<p> <img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_6A4E09F4473D-1.jpeg" alt="IMG_6A4E09F4473D-1"></p>
<p> <img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_28496E1077AB-1.jpeg" alt="IMG_28496E1077AB-1"></p>
<p> 操作练习</p>
<p> <img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_855740C3FF9C-1.jpeg" alt="IMG_855740C3FF9C-1"></p>
</li>
<li><p>vi的暂存档。当使用vi编辑时，会在同目录下创建一个.filename.swp的文件。当突然中断后，会出现这个页面。</p>
<p> <img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20200426111858492.png" alt="image-20200426111858492"></p>
<p> 按照需要的方式输入字母即可。</p>
</li>
<li><p>区块选择</p>
</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_E542292E6459-1.jpeg" alt="IMG_E542292E6459-1"></p>
<ul>
<li><p>多文件编辑</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_FBF7D5BD084E-1.jpeg" alt="IMG_FBF7D5BD084E-1"></p>
</li>
<li><p>多窗口编辑</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_A658F1E6441A-1.jpeg" alt="IMG_A658F1E6441A-1"></p>
</li>
<li><p>vim的补全功能。没有搞明白，后续有知道的可以补充一下。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_2453B42FB883-1.jpeg" alt="IMG_2453B42FB883-1"></p>
</li>
<li><p>vim的环境设定与记录</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_F5422405CB23-1.jpeg" alt="IMG_F5422405CB23-1"></p>
</li>
<li><p>vim常用的命令</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_24AC0E8650BF-1.jpeg" alt="IMG_24AC0E8650BF-1"></p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/14/Linux%E5%AD%A6%E4%B9%A0/%E7%AC%AC%E4%B9%9D%E7%AB%A0%E3%80%81vim%E7%A8%8B%E5%BA%8F%E7%BC%96%E8%BE%91%E5%99%A8/" data-id="ckuqw9s6v000vxcup056i85yr" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Linux学习/第八章、文件与文件系统的压缩、打包与备份" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/10/14/Linux%E5%AD%A6%E4%B9%A0/%E7%AC%AC%E5%85%AB%E7%AB%A0%E3%80%81%E6%96%87%E4%BB%B6%E4%B8%8E%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8E%8B%E7%BC%A9%E3%80%81%E6%89%93%E5%8C%85%E4%B8%8E%E5%A4%87%E4%BB%BD/" class="article-date">
  <time datetime="2021-10-14T10:09:31.647Z" itemprop="datePublished">2021-10-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux%E5%AD%A6%E4%B9%A0/">Linux学习</a>
  </div>

  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="第八章、文件与文件系统的压缩、打包和备份"><a href="#第八章、文件与文件系统的压缩、打包和备份" class="headerlink" title="第八章、文件与文件系统的压缩、打包和备份"></a>第八章、文件与文件系统的压缩、打包和备份</h2><ul>
<li><p>Linux常见的压缩命令</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_BCF8665FBBD5-1.jpeg" alt="IMG_BCF8665FBBD5-1"></p>
<ul>
<li><p><code>gzip</code>压缩命令</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_6583B53AC8BC-1.jpeg" alt="IMG_6583B53AC8BC-1"></p>
</li>
<li><p><code>bzip2</code>压缩命令</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_5C7656007A22-1.jpeg" alt="IMG_5C7656007A22-1"></p>
</li>
<li><p><code>xz</code>压缩命令</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_C8C028350B6E-1.jpeg" alt="IMG_C8C028350B6E-1"></p>
</li>
</ul>
</li>
<li><p><code>tar</code>打包命令</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_A140720C58E7-1.jpeg" alt="IMG_A140720C58E7-1"></p>
<ul>
<li><p>压缩<br><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20200425104505375.png" alt="image-20200425104505375"></p>
</li>
<li><p>解压</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20200425105144263.png" alt="image-20200425105144263"></p>
</li>
<li><p>解压某个文件，这个压缩文件仍然在压缩包里面。<br><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20200425105817037.png" alt="image-20200425105817037"></p>
</li>
<li><p>打包某个目录，但不打包某些文件</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20200426091434124.png" alt="image-20200426091434124"></p>
</li>
<li><p>利用管线命令将目录复制到另外的地方。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_DA0A5D46ECC1-1.jpeg" alt="IMG_DA0A5D46ECC1-1"></p>
</li>
</ul>
</li>
<li><p>XFS文件系统的备份和还原</p>
<ul>
<li><p><code>xfsdump</code>对XFS文件系统备份</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_88F902852F05-1.jpeg" alt="IMG_88F902852F05-1"></p>
</li>
<li><p><code>xfsrestore</code>对XFS文件系统还原</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_96D8641A09A2-1.jpeg" alt="IMG_96D8641A09A2-1"></p>
</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/14/Linux%E5%AD%A6%E4%B9%A0/%E7%AC%AC%E5%85%AB%E7%AB%A0%E3%80%81%E6%96%87%E4%BB%B6%E4%B8%8E%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%8E%8B%E7%BC%A9%E3%80%81%E6%89%93%E5%8C%85%E4%B8%8E%E5%A4%87%E4%BB%BD/" data-id="ckuqw9s7k000wxcupapo424nq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Linux学习/第六章、Linux文件与目录管理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/10/14/Linux%E5%AD%A6%E4%B9%A0/%E7%AC%AC%E5%85%AD%E7%AB%A0%E3%80%81Linux%E6%96%87%E4%BB%B6%E4%B8%8E%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/" class="article-date">
  <time datetime="2021-10-14T10:09:31.647Z" itemprop="datePublished">2021-10-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux%E5%AD%A6%E4%B9%A0/">Linux学习</a>
  </div>

  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Linux学习"><a href="#Linux学习" class="headerlink" title="Linux学习"></a>Linux学习</h1><h2 id="第六章、Linux文件与目录管理"><a href="#第六章、Linux文件与目录管理" class="headerlink" title="第六章、Linux文件与目录管理"></a>第六章、Linux文件与目录管理</h2><h3 id="文件与目录管理"><a href="#文件与目录管理" class="headerlink" title="文件与目录管理"></a>文件与目录管理</h3><ul>
<li><p><code>ls</code>命令</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_E867F1DE7BD3-1.jpeg" alt="IMG_E867F1DE7BD3-1"></p>
</li>
<li><p>复制、删除与移动  <code>cp</code>,<code>rm</code>,<code>mv</code><br><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_83380C6DF2B8-1.jpeg" alt="IMG_83380C6DF2B8-1"></p>
<h3 id="文件内容查阅"><a href="#文件内容查阅" class="headerlink" title="文件内容查阅"></a>文件内容查阅</h3></li>
<li><p><code>cat</code>：从第一行显示到最后一行<br><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_76BB5886D069-1.jpeg" alt="IMG_76BB5886D069-1"></p>
</li>
<li><p><code>tac</code>：从最后一行显示到第一行        </p>
</li>
<li><p><code>nl</code>：显示的时候显示行号<br><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_14F24DA98032-1.jpeg" alt="IMG_14F24DA98032-1"></p>
</li>
<li><p><code>more</code>：一页一页的显示文本<br><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_F97B32F53055-1.jpeg" alt="IMG_F97B32F53055-1"></p>
</li>
<li><p><code>less</code>：一页一页显示文本，但是可以往前翻页<br><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_777F6AABB74F-1.jpeg" alt="IMG_777F6AABB74F-1"></p>
</li>
<li><p><code>head</code>：只看头几行<br><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_B955711F9456-1.jpeg" alt="IMG_B955711F9456-1"></p>
</li>
<li><p><code>tail</code>：只看后面几行<br><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_9D3335EA23B0-1.jpeg" alt="IMG_9D3335EA23B0-1"></p>
</li>
<li><p><code>od</code>：以二进制的形式读取文件内容<br><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_1F0EC4C06432-1.jpeg" alt="IMG_1F0EC4C06432-1"><br>取一个文件11行到20行到内容<br><code>head -n 20 /test.txt | tail -n 10    </code><br>管线符号<code>｜</code>：前面的指令所输出的信息，通过管线命令交给后续指令继续使用<br>显示行号：<code>cat -n test.txt | head -n 20 | tail -n 10</code>        </p>
</li>
<li><p><code>touch</code>修改文件时间或创建一个新的文档<br><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_F1CC616035BD-1.jpeg" alt="IMG_F1CC616035BD-1">            </p>
</li>
</ul>
<h3 id="文件与目录的默认权限和隐藏权限"><a href="#文件与目录的默认权限和隐藏权限" class="headerlink" title="文件与目录的默认权限和隐藏权限"></a>文件与目录的默认权限和隐藏权限</h3><p><code>umask</code>指定用户在创建文件或者目录时的默认权限值<br><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_00741A334223-1.jpeg" alt="IMG_00741A334223-1"><br>默认权限值代表的意思<br><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_39339A93FE77-1.jpeg" alt="IMG_39339A93FE77-1"></p>
<ul>
<li><p><code>chattr</code>配置文件隐藏的属性（和下面的一个命令一样不是很常用）<br><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_DDB37D20B3DD-1.jpeg" alt="IMG_DDB37D20B3DD-1"></p>
</li>
<li><p><code>lsattr</code>显示文件的隐藏属性</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_8CF328C04A07-1.jpeg" alt="IMG_8CF328C04A07-1"></p>
</li>
<li><p>文件的特殊权限：SUID,SGID,SBIT</p>
<p>SUID指文件的执行者在执行程序时拥有文件拥有者相同的权限，一般出现在文件拥有者的x权限上。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_27D05CA751BD-1.jpeg" alt="IMG_27D05CA751BD-1"></p>
<p>SGID是SUID的升级版，升级为文件的群组。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_8541875233A9-1.jpeg" alt="IMG_8541875233A9-1"></p>
<p>SBIT只针对目录，在该目录下创建的文件只有自己或者root才能修改或者删除</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_9CF18B040559-1.jpeg" alt="IMG_9CF18B040559-1"></p>
<p>授权上面的三种特殊权限可以通过数字或者字符</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20200412204346040.png" alt="image-20200412204346040"></p>
</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20200412204449320.png" alt="image-20200412204449320"></p>
<ul>
<li><code>file</code>命令用来查看文件的类型</li>
<li><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_31B8AC9CC1EB-1.jpeg" alt="IMG_31B8AC9CC1EB-1"></li>
</ul>
<h3 id="指令与文件的搜寻"><a href="#指令与文件的搜寻" class="headerlink" title="指令与文件的搜寻"></a>指令与文件的搜寻</h3><ul>
<li><p><code>which</code>寻找可执行的文档</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_2760EE6A96EE-1.jpeg" alt="IMG_2760EE6A96EE-1"></p>
</li>
<li><p><code>whereis</code>寻找系统中某些特定目录底下的文件(用处估计不是很多，但是速度快)</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_00AD66018E29-1.jpeg" alt="IMG_00AD66018E29-1"></p>
</li>
<li><p><code>locate</code>命令是在系统建立的数据库（一天修改一次的数据库）中查询文件。一般配合<code>updatedb</code>使用（用到的地方也是很少）</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_1169BF8BB661-1.jpeg" alt="IMG_1169BF8BB661-1"></p>
</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_4F1C1F7A6DD6-1.jpeg" alt="IMG_4F1C1F7A6DD6-1"></p>
<ul>
<li><p><code>find</code>命令是一个非常强大的命令的，但是是因为直接读取的硬盘，所以速度没有上面两个快。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_7FC983BD2FC3-1.jpeg" alt="IMG_7FC983BD2FC3-1"></p>
</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_D52E7DA4D5A9-1.jpeg" alt="IMG_D52E7DA4D5A9-1"></p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_FD693BD4905F-1.jpeg" alt="IMG_FD693BD4905F-1"></p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_3EDE5760B28D-1.jpeg" alt="IMG_3EDE5760B28D-1"></p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_A65852973ABA-1.jpeg" alt="IMG_A65852973ABA-1"></p>
<p>自己的理解，和管线命令类似。但是是以参数的形式<img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20200412214544680.png" alt="image-20200412214544680"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/14/Linux%E5%AD%A6%E4%B9%A0/%E7%AC%AC%E5%85%AD%E7%AB%A0%E3%80%81Linux%E6%96%87%E4%BB%B6%E4%B8%8E%E7%9B%AE%E5%BD%95%E7%AE%A1%E7%90%86/" data-id="ckuqw9s7q000xxcup1vcw8vh8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Linux学习/第十章、学习BASH" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/10/14/Linux%E5%AD%A6%E4%B9%A0/%E7%AC%AC%E5%8D%81%E7%AB%A0%E3%80%81%E5%AD%A6%E4%B9%A0BASH/" class="article-date">
  <time datetime="2021-10-14T10:09:31.647Z" itemprop="datePublished">2021-10-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux%E5%AD%A6%E4%B9%A0/">Linux学习</a>
  </div>

  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="第十章、学习BASH"><a href="#第十章、学习BASH" class="headerlink" title="第十章、学习BASH"></a>第十章、学习BASH</h2><p>​    这次就来学习一下最基础的BASH，下面直接开搞。</p>
<ul>
<li><code>type</code>命令</li>
</ul>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_A2A285D5741D-1.jpeg" alt="IMG_A2A285D5741D-1"></p>
<ul>
<li><p><code>echo</code>读取变量的内容</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_E19EBBDADCF9-1.jpeg" alt="IMG_E19EBBDADCF9-1"></p>
</li>
<li><p>关于引号</p>
<p>单引号赋值只会赋值引号内的内容，双引号可以保存变量的内容，反引号会先执行。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20200621082943077.png" alt="image-20200621082943077"></p>
</li>
<li><p>环境变量</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_01BE4759785E-1.jpeg" alt="IMG_01BE4759785E-1"></p>
<ul>
<li>提示变量的设定</li>
</ul>
<p>提示变量就是你执行命令前面的东西，这个其实是可以设置的。下面就介绍一下。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_65F50926A71F-1.jpeg" alt="IMG_65F50926A71F-1"></p>
<p>设置就是这个样子，很有意思，可以按照上面的信息自己设置一下。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20200629232612846.png" alt="image-20200629232612846"></p>
<ul>
<li><p>$ 符的使用</p>
<p>就是代表的当前Sheel的线程代号（就是PID）。如下图。</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20200629233227290.png" alt="image-20200629233227290"></p>
</li>
<li><p>? 符的使用</p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/IMG_DDDB2B3AAC11-1.jpeg" alt="IMG_DDDB2B3AAC11-1"></p>
<p><img src="https://1162210866.oss-cn-beijing.aliyuncs.com/uPic/image-20200629233555410.png" alt="image-20200629233555410"></p>
</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/14/Linux%E5%AD%A6%E4%B9%A0/%E7%AC%AC%E5%8D%81%E7%AB%A0%E3%80%81%E5%AD%A6%E4%B9%A0BASH/" data-id="ckuqw9s7r000yxcupct7h2wf5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-netty/Netty简单demo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/10/14/netty/Netty%E7%AE%80%E5%8D%95demo/" class="article-date">
  <time datetime="2021-10-14T10:09:31.647Z" itemprop="datePublished">2021-10-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/netty/">netty</a>
  </div>

  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Netty简单demo"><a href="#Netty简单demo" class="headerlink" title="Netty简单demo"></a>Netty简单demo</h2><p>​    上篇博客简单介绍了Netty的一些基础概念和组件，这次就来写一个简单的demo，因为公司需要的是TCP服务端，所以这次的demo就写一个TCP服务端。下面就直接上代码。</p>
<p>​    首先是主类，里面也放着Netty的启动方法和执行流程。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> nettytrain;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelOption;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.EventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * TCPServerTrain.java</span></span><br><span class="line"><span class="comment"> * Description:  netty服务端的练习</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Peng Shiquan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TCPServerTrain</span> </span>&#123;</span><br><span class="line">    <span class="comment">//默认端口</span></span><br><span class="line">    <span class="keyword">private</span> Integer port = <span class="number">10000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TCPServerTrain</span><span class="params">(Integer port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.port = port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 接收传入的连接</span></span><br><span class="line">        EventLoopGroup bossGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line">        <span class="comment">//处理传入的连接，一般是bossGroup的二倍</span></span><br><span class="line">        EventLoopGroup workGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//服务端应用开发的入口</span></span><br><span class="line">            ServerBootstrap serverBootstrap = <span class="keyword">new</span> ServerBootstrap();</span><br><span class="line">            <span class="comment">//设置主从线程池</span></span><br><span class="line">            serverBootstrap.group(bossGroup, workGroup)</span><br><span class="line">                    <span class="comment">//指定通道channel的类型，因为是服务端，所以是NioServerSocketChannel</span></span><br><span class="line">                    .channel(NioServerSocketChannel.class)</span><br><span class="line">                    <span class="comment">//设置子通道也就是SocketChannel的处理器</span></span><br><span class="line">                    .childHandler(<span class="keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                            socketChannel.pipeline().addLast(<span class="keyword">new</span> TCPServerHandler());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                    <span class="comment">//配置ServerSocketChannel的选项</span></span><br><span class="line">                    .option(ChannelOption.SO_BACKLOG, <span class="number">128</span>)</span><br><span class="line">                    <span class="comment">//配置子通道也就是SocketChannel的选项</span></span><br><span class="line">                    .childOption(ChannelOption.SO_KEEPALIVE, <span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">//绑定并侦听某个端口</span></span><br><span class="line">            ChannelFuture channelFuture = serverBootstrap.bind(port).sync();</span><br><span class="line">            <span class="comment">//如何没有客户端连接就会关闭Channel和两个线程池</span></span><br><span class="line">            channelFuture.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 关闭线程池</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            workGroup.shutdownGracefully();</span><br><span class="line">            bossGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> port = <span class="number">10000</span>;</span><br><span class="line">        <span class="keyword">if</span> (args.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            port = Integer.parseInt(args[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">new</span> TCPServerTrain(port).run();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    代码里面的注释已经很清楚了，没有什么可以细讲的地方。下面的就是业务处理类，自己的业务处理主要放在这里。代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> nettytrain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBuf;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.CharsetUtil;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.ReferenceCountUtil;</span><br><span class="line"><span class="keyword">import</span> network_train.ARPojo;</span><br><span class="line"><span class="keyword">import</span> network_train.ARSwitch;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * TCPServerHandler.java</span></span><br><span class="line"><span class="comment"> * Description: 主要的业务处理类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Peng Shiquan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TCPServerHandler</span> <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description: 通道的读取操作方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>: Peng Shiquan</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>: 2020/6/19</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ByteBuf recvmg = (ByteBuf) msg;</span><br><span class="line">            String line = recvmg.toString(CharsetUtil.UTF_8);</span><br><span class="line">            System.err.println(<span class="string">&quot;接收到消息&quot;</span> + line);</span><br><span class="line">            <span class="keyword">if</span> (line.contains(<span class="string">&quot;BG&quot;</span>) &amp;&amp; line.contains(<span class="string">&quot;ED&quot;</span>)) &#123;</span><br><span class="line">                ARPojo arPojo = ARSwitch.LineSwitch(line);</span><br><span class="line">                System.err.println(<span class="string">&quot;转换为pojo对象&quot;</span> + arPojo.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 释放msg</span></span><br><span class="line">            ReferenceCountUtil.release(msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description:  异常捕获</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cause</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>: Peng Shiquan</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>: 2020/6/19</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    也是没有什么可以讲的地方，这里的业务处理我放在其他的地方了，所以这里的代码很少，每个人的业务不同，所以业务处理也不同。</p>
<p>​    下面就说说遇到的问题。就是通道读取的方法，刚开始不知道怎么处理msg，后来转换成<code>ByteBuf</code>,再转换的<code>String</code>，这个地方不知道处理的对不对。其他的问题就是这个代码没有考虑到粘包的现象，现在还没有涉及到，所以没有写，后面慢慢补上。</p>
<p>​    就这样吧，结束。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/14/netty/Netty%E7%AE%80%E5%8D%95demo/" data-id="ckuqw9s8d0017xcupdsmjf48g" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-netty/Netty解码器使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/10/14/netty/Netty%E8%A7%A3%E7%A0%81%E5%99%A8%E4%BD%BF%E7%94%A8/" class="article-date">
  <time datetime="2021-10-14T10:09:31.647Z" itemprop="datePublished">2021-10-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/netty/">netty</a>
  </div>

  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Netty解码器了解和使用"><a href="#Netty解码器了解和使用" class="headerlink" title="Netty解码器了解和使用"></a>Netty解码器了解和使用</h2><p>​    距离上次了解Netty已经过去半年了，最近需要编写一个客户端去连接一个设备，发现Netty编写客户端比服务端复杂一点，回头看自己写的服务端的博客，发现当时的了解也是一知半解，整片博客达不到我想象中的要求。现在才发现写博客原来还是有一些技术含量的。我也没有修改写完的博客的习惯。就当成自己的黑历史吧，但是后续自己还是要记录的。中间发现一片博客对于Netty的入门的一些概念讲的比较清楚，这里也放上来。<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/insjE_EJRoCOM-1GqgZP9A">Netty架构与原理</a></p>
<p>​    也就不多说废话了，这边博客讲的是解码器的使用，关于客户端的讲解和代码放到后面一片博客上。下面就直接开始。</p>
<p>​    编码器和解码器其实是一个概念，上一篇博客讲过Netty中的几个重要的组件，其中编解码器在最下面。解码器意如其名，就是对于网络上接收的字节进行解码，将字节转换为相应的java对象，再传给业务处理类，同时对于TCP中的粘包和拆包现象在解码器中处理也是比较方便的。关于粘包问题的解释和做法可以看官网的解释<a target="_blank" rel="noopener" href="https://netty.io/wiki/user-guide-for-4.x.html#dealing-with-a-stream-based-transport">官网对于粘包的解释和处理</a>。最开始我的本意也是处理粘包的现象，同时对收到的数据做校验。所以就查询了一下相关的资料。编码器则是发送数据时将java对象转换为字节数据，再通过网络发送出去，和解码器类似，只不过用的地方不一样。我的代码不涉及发送数据，所以本次博客不再记录编码器，估计使用方法和解码器类似，可能就是方法不一样。</p>
<p>​    Netty想到了粘包和拆包的问题，所以有几种自带的解码器，可以直接使用。LineBasedFrameDecoder（基于特殊分隔符的解码器，例如<code>\r\n</code>）、DelimiterBasedFrameDecoder（更加通用的分隔符解码器，支持多个特殊分隔符）、FixedLengthFrameDecoder（固定长度的解码器）、LengthFieldBasedFrameDecoder（可以按照长度字段动态的解码器，比较符合我们的要求了）。基本常用的解码器就这几种了，最后一个比较符合我们的需求，但是因为后续可能会发生变化，同时，我也想在解码器里面对数据做校验，所以这里打算自己编写解码器。</p>
<p>​    自定义解码器只需要让类继承ByteToMessageDecoder，然后重写自己的方法就可以了。这里我记得Netty有几种解码器，分别解析int short和二进制，但是忘记到底是什么了，欢迎大家补充。</p>
<p>​    继承ByteToMessageDecoder后，只需要重写<code>decode()</code>方法就可以完成解码的工作，这里简单列举一下自己的代码，因为大部分都涉及到业务处理，这部分和解码器无关，不再记录。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Description: 先处理粘包的问题，再对所有数据和数据模块做校验</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx ChannelHandler 和ChannelPipeline 之间的关联</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> in 输入的Buf</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> out 输出的Buf</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>: Peng Shiquan</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span>: 2020/11/30</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">decode</span><span class="params">(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      	<span class="comment">//获取buf中写指针的位置，相当于buf中能读的数据的长度</span></span><br><span class="line">        <span class="keyword">int</span> bufferLength = in.writerIndex();</span><br><span class="line">      	<span class="comment">//获取指定帧头的位置</span></span><br><span class="line">        <span class="keyword">int</span> headIndex = ByteBufUtil.indexOf(RadarMessageUtil.HEAD_BUF, in);</span><br><span class="line">        <span class="keyword">int</span> surplusLength = RadarMessageUtil.HEAD_LENGTH + RadarMessageUtil.SUM_LENGTH + RadarMessageUtil.CALIBRATE_LENGTH;</span><br><span class="line">      	<span class="comment">//获取当前数据最短的长度，帧头+数据长度位+数据+校验位</span></span><br><span class="line">        <span class="keyword">int</span> shortData = in.getUnsignedShort(headIndex + RadarMessageUtil.HEAD_LENGTH) + surplusLength;</span><br><span class="line">        <span class="keyword">if</span> (headIndex &gt;= <span class="number">0</span> &amp;&amp; bufferLength &gt;= shortData) &#123;</span><br><span class="line">            <span class="keyword">int</span> dataLength = shortData - surplusLength;</span><br><span class="line">            <span class="keyword">byte</span>[] rs = <span class="keyword">new</span> <span class="keyword">byte</span>[dataLength];</span><br><span class="line">            in.getBytes(headIndex + RadarMessageUtil.HEAD_LENGTH + RadarMessageUtil.SUM_LENGTH, rs);</span><br><span class="line">            <span class="keyword">if</span> (compareBytes(rs)) &#123;</span><br><span class="line">              	<span class="comment">//添加该buf到输出中，这里也可以将buf再次转换为java对象</span></span><br><span class="line">                out.add(rs);</span><br><span class="line">            &#125;</span><br><span class="line">          	<span class="comment">//将读写指针复位</span></span><br><span class="line">            in.readerIndex(headIndex + RadarMessageUtil.HEAD_LENGTH + RadarMessageUtil.SUM_LENGTH + dataLength + RadarMessageUtil.CALIBRATE_LENGTH);</span><br><span class="line">            in.discardReadBytes();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;接收的数据不满足最小长度或者不包含帧头&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>​    代码就是上面的代码，不是很复杂。简单说一下思路。先是获取整个缓冲区的数据长度，再判断帧头的位置，将帧头后两位的数据解析为数据长度，判断缓存区整个数据长度是不是大于这个长度，如果大于就代表这个包全了，可以解析，将这个buf转换成字节数组再放到out里面（不是必须转换为字节数组）。如果小于则代表缓冲区内数据不全，需要继续等待缓冲区内数据补充，直接返回就可以。如果正常读取后，最后需要将buf中的指针操作都复位，要不然buf的大小会越来越小。</p>
<p>​    以上就是一个解决特定帧头，动态长度的解码器。当然，这个解码器还可以做的更多，例如对数据做校验，这里也就不再展开了。运行效果和网上其他的类似，能够解决相应的粘包问题。使用也比较简单，在添加业务处理类前添加解码器即可。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Bootstrap b = <span class="keyword">new</span> Bootstrap();</span><br><span class="line">       RadarConnectThread radarConnectThread = <span class="keyword">this</span>;</span><br><span class="line">       b.group(eventLoopGroup).channel(NioSocketChannel.class)</span><br><span class="line">               .option(ChannelOption.TCP_NODELAY, <span class="keyword">true</span>)</span><br><span class="line">               .option(ChannelOption.CONNECT_TIMEOUT_MILLIS, <span class="number">6000</span>)</span><br><span class="line">               .option(ChannelOption.SO_KEEPALIVE, <span class="keyword">false</span>)</span><br><span class="line">               .handler(<span class="keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                   <span class="meta">@Override</span></span><br><span class="line">                   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel socketChannel)</span> </span>&#123;</span><br><span class="line">                       socketChannel.pipeline().addLast(<span class="keyword">new</span> RadarDecoder()).addLast(<span class="keyword">new</span> RadarHandler(radarConnectThread));</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> b;</span><br></pre></td></tr></table></figure>

<p>​    中间还是有一些点讲的不是很清楚，后续还会补充一片Netty客户端的博客，这篇博客更加全面的记录，同时修正之前博客的错误（又是一个坑）。</p>
<p>​    那就这样吧，结束。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/14/netty/Netty%E8%A7%A3%E7%A0%81%E5%99%A8%E4%BD%BF%E7%94%A8/" data-id="ckuqw9s8f0019xcup6mf3frtf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/7/">&amp;laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/9/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/C%E5%AD%A6%E4%B9%A0/">C学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Docker%E5%AD%A6%E4%B9%A0/">Docker学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%9F%BA%E7%A1%80/">Java基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux%E5%AD%A6%E4%B9%A0/">Linux学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringCloud/">SpringCloud</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/netty/">netty</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/storm%E5%AD%A6%E4%B9%A0/">storm学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/ElasticSearch/">ElasticSearch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/PostgreSQL/">PostgreSQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/RabbitMQ/">RabbitMQ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/Redis/">Redis</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%8F%E8%AE%AE/">协议</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%8F%E8%AE%AE/HTTP/">HTTP</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BF%83%E5%BE%97/">心得</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E9%A1%B9/">杂项</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A1%86%E6%9E%B6/Dubbo%E6%A1%86%E6%9E%B6/">Dubbo框架</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%A1%86%E6%9E%B6/Spring%E7%9B%B8%E5%85%B3%E6%A1%86%E6%9E%B6/">Spring相关框架</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">计算机基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/10/14/%E4%B8%AD%E9%97%B4%E4%BB%B6/ElasticSearch/ElasticSearch%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E7%82%B9/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/10/14/%E4%B8%AD%E9%97%B4%E4%BB%B6/ElasticSearch/elasticsearch%E6%90%AD%E5%BB%BA%E5%92%8Capi%E4%BD%BF%E7%94%A8/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/10/14/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/MySQL%E4%BA%8B%E5%8A%A1%E4%BA%86%E8%A7%A3/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/10/14/%E4%B8%AD%E9%97%B4%E4%BB%B6/MySQL/SQL%E8%AF%AD%E6%B3%95/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/10/14/%E4%B8%AD%E9%97%B4%E4%BB%B6/PostgreSQL/Centos%E5%AE%89%E8%A3%85Postgresql%E5%92%8Cposogis%E6%8F%92%E4%BB%B6/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>